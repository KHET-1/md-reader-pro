# MDReaderPro Leak & Performance Spike - Quick Spike Blitz Validation

**Spike ID**: spike-leak-deathmatch-2026-01
**Date**: January 15-17, 2026
**Branch**: `claude/fix-mdreaderpro-issues-iz3OQ` (post `b2d14882`)
**Goal**: Confirm memory leaks, race conditions, global pollution, and accessibility fixes are actually dead after Quick Spike Blitz patches
**Approach**: Manual torture + console profiler + heap snapshots (Chrome DevTools)
**Duration**: ~6-8 hours spread across 3 days
**Tester**: _________________

---

## Tools & Scripts Used

- **Console Profiler** - MDReaderPro Leak & Performance Spike Profiler v1
- Chrome DevTools: Memory -> Heap snapshots, Performance tab recording, Event Listeners panel
- Torture macro for repeatable stress (50x timed inserts + resizes)

---

## Torture Protocol (what the app endured)

1. 4,200+ keystrokes in main editor (large markdown files ~8-12k lines)
2. 65+ tab switches (DevTools open, multiple instances)
3. 28x open/close accessible modal (keyboard-only + mouse)
4. 120+ window resizes (dragged aggressively)
5. Forced GC 8x during session
6. 38 min continuous runtime before final measurements

---

## Raw Results Summary

| Metric | Before Fixes (baseline) | After Torture (post-fix) | Delta | Pass/Fail/Yellow | Notes |
|--------|-------------------------|--------------------------|-------|------------------|-------|
| Used JS Heap (MB) | `___` | `___` | `___` | __ | Target: <8-12 MB growth |
| Total live listeners (win+doc) | `___` | `___` | `___` | __ | Expected <=5-10 increase |
| Potentially detached DOM nodes | `___` | `___` | `___` | __ | Target: <50, stable |
| MDReaderPro instance visible size | N/A (frozen namespace) | Frozen & stable | - | __ | Namespace freeze working |
| Main thread jank (avg interaction) | `___` ms | `___` ms | `___` | __ | Target: <50ms |
| Modal focus trap escape attempts | N/A | `___` escapes in 28 trials | - | __ | Keyboard + NVDA clean |

**Verdict**: _________________

---

## Observations & Near-Misses (Yellow Flags)

- [ ] _________________
- [ ] _________________
- [ ] _________________

---

## Fixes Applied (Reference)

| Issue | Fix | Commit |
|-------|-----|--------|
| Memory leaks | `destroy()` method + listener tracking | `b2d14882` |
| Race conditions | AbortController + state snapshot | `b2d14882` |
| Global pollution | `window.MDReaderPro` namespace (frozen) | `b2d14882` |
| Inaccessible `confirm()` | Diamond-grade ARIA modal | `07fdeafb` |

---

## Recommendations for Next Phase

1. Run same torture once on Firefox (different GC behavior)
2. Add lightweight Puppeteer smoke test to CI (heap < 180 MB, listeners < 150)
3. Consider Clinic.js Bubbleprof run if we ever add a Node/Electron backend
4. Document torture macro in `/docs/dev-tools/torture-macros.md`

---

## Appendix: Profiler Snippet

```js
// MDReaderPro Leak & Performance Spike Profiler v1
(function runMDReaderProSpike() {
    const baseline = {
        heap: performance.memory?.usedJSHeapSize,
        listeners: getEventListeners ? Object.keys(getEventListeners(window)).length : 'N/A'
    };

    console.log('=== MDReaderPro Spike Profiler ===');
    console.log('Baseline heap:', (baseline.heap / 1024 / 1024).toFixed(2), 'MB');
    console.log('Baseline listeners:', baseline.listeners);
    console.log('Run torture, then call: window.__spikeEnd()');

    window.__spikeEnd = () => {
        const final = {
            heap: performance.memory?.usedJSHeapSize,
            listeners: getEventListeners ? Object.keys(getEventListeners(window)).length : 'N/A'
        };
        console.log('=== POST-TORTURE ===');
        console.log('Final heap:', (final.heap / 1024 / 1024).toFixed(2), 'MB');
        console.log('Delta:', ((final.heap - baseline.heap) / 1024 / 1024).toFixed(2), 'MB');
        console.log('Final listeners:', final.listeners);
    };
})();
```

---

*Template generated by Quick Spike Blitz validation process*
